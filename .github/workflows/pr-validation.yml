name: PR Validation

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  validate-pr-title:
    name: Validate PR Title
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Validate PR Title
        uses: docker://ghcr.io/scarf005/conventional-prs:main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          INPUT_VALIDATE_PR_TITLE: 'true'
      
      - name: Comment on PR
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: '❌ **PR title validation failed**\n\nYour PR title does not follow the Conventional Commits specification. Please check the workflow logs for details.\n\n**Valid format**: `<type>[optional scope]: <description>`\n\n**Valid types**: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert'
            })

  validate-commits:
    name: Validate Commits
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Validate All Commits
        uses: docker://ghcr.io/scarf005/conventional-prs:main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          INPUT_VALIDATE_COMMITS: 'true'
      
      - name: Comment on PR
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: '❌ **Commit validation failed**\n\nOne or more commits do not follow the Conventional Commits specification. Please check the workflow logs for details.'
            })
